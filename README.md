# BME504_Project
BME504 project

# 更新版 
## 请注意现在aim1 改成 直接注入电流， aim2 为外场刺激 ，务必修改！！！！

Aim 1 — Intracellular current injection to quantify waveform-dependent membrane excitability

中文：研究目标 1 —— 通过膜内电流注入定量分析不同波形对膜兴奋性的影响


中文版本
目标 1 用于量化 ETI 滤波的电压控制刺激（CV）相对于理想恒流刺激（CC）在 轴突膜本征兴奋性 上的差异。
我们首先通过 Randles 型电极–组织界面模型将 CV 脉冲转换为其 实际注入膜内的有效电流波形，并与幅值匹配的双相 CC 电流一起，通过 I-clamp 直接注入轴突中心节点。
针对每种纤维直径，我们求解引发动作电位所需的最小电流幅度，即 膜内阈值电流 Ith。
该目标纯粹评估刺激波形对膜兴奋性的影响，而不受外场几何耦合因素影响

Aim 2 — Extracellular stimulation to determine diameter-dependent recruitment and selectivity

中文：研究目标 2 —— 基于外场刺激评估纤维直径依赖的招募顺序与选择性


中文版本
目标 2 用于评估 CC 与经 ETI 滤波的 CV 波形在 真实外场刺激条件 下对不同直径纤维的招募特性影响。
我们采用点源体积导体模型，将同一组 CC / CV 单位电流波形视为电极输出，计算其在各节点产生的时空外电位，并施加于轴突的 extracellular 通道。
通过对每个直径求得外场阈值电流 Ith，进一步构建 招募顺序（按阈值从低到高）与 招募曲线（刺激强度与被激活纤维比例的函数）。
该目标揭示 ETI 滤波与空间电场耦合如何共同影响不同直径纤维的招募选择性。


## method部分

为比较恒流刺激（CC）与电压控制刺激（CV）在轴突膜本征兴奋性上的差异，我们首先生成两类波形实际注入膜内的有效电流。由于电压刺激不会直接向组织施加电流，而是受到电极–组织界面（ETI）电容性与法拉第过程的显著调制，因此需要通过模型推算其真实注入电流。为此，本研究采用 Randles 型 ETI 模型，包括串联电阻、双电层电容与电荷转移电阻，将矩形电压脉冲（10 mV，0.2–0.7 ms）转化为膜内电流。使用 1 µs 的时间步长对 ETI 动力学进行数值积分，得到的电流波形呈现典型的“初始高峰 + 指数衰减”形态，与文献中报道的电压驱动刺激一致。相比之下，CC 刺激采用理想的双相电流脉冲（每相 500 µs，测试阳极先与阴极先）。为确保兴奋性差异完全来源于波形形状而非幅值大小，所有 CC 与 CV 波形均归一化至相同的峰值电流 100 µA。由于进行了峰值归一化，本研究以触发动作电位所需的最小等效电流幅度（即峰值电流阈值）作为 CC 与 CV 兴奋性比较的依据。

为了在不同纤维直径条件下进行可控比较，我们在 NEURON 中构建了简化的 MRG 型有髓轴突模型。模型包含 21 个郎飞结，每个节点均采用单一分区结构，包含快速钠通道、钾通道或相应的 Hodgkin–Huxley 替代机制。Internode 段建模为被动电缆，其长度随直径线性增加，范围在 50–500 µm 内，符合哺乳动物有髓纤维的形态学特征。节点钠通道电导随直径按幂律上升，以匹配生理上大直径纤维更易兴奋与更快传导的趋势。模拟的纤维直径范围为 5.7–16.0 µm。所有仿真采用 0.001 ms（1 µs）的固定步长，以保证与刺激波形的时间分辨率匹配。

在 Aim 1 中，为避免外场几何影响，我们将 CC 与经 ETI 滤波的 CV 波形直接以膜内电流方式注入中心节点（node 10），以纯粹评估膜兴奋性。注入电流通过一个幅度缩放因子进行调节，该因子通过指数包围与二分搜索联合确定，使得最终找到可以引发动作电位的最小幅度。动作电位的判定标准包括：膜电位超过 0 mV、去极化上升速率大于 20 mV/ms，并能成功传播至远端节点。对应的峰值电流定义为该直径条件下的膜内阈值电流，反映了在 CC 或 CV 刺激下膜被激活所需的有效峰值电流大小。

在 Aim 2 中，我们将相同的 CC 与 CV 单位波形视为电极输出电流，通过点源体积导体模型计算其在各节点处产生的外电位，并通过 NEURON 的 extracellular 机制施加于轴突。电极置于距轴突侧向 0.5 mm 处并与中心节点对齐。在每种直径下，我们使用与 Aim 1 相同的阈值搜索方法确定能够引发并传播动作电位的最小外场电流。外场阈值同时受膜兴奋性与外场激活函数几何分布影响，因此能综合反映波形及空间耦合的共同效应。

为了描述不同直径纤维在刺激强度增加过程中的招募特性，我们根据各直径的外场阈值从低到高排序以获得招募顺序。随后，通过逐步提高刺激幅度并计算已达到阈值的纤维比例，我们绘制了招募曲线，用以表征招募过程的陡峭程度、直径选择性以及 ETI 滤波对招募延迟或扩散的影响。


## 结果请看aim1 和 aim2 两个文件夹

###  aim1

关于波形模板、缩放与阈值计算的一般说明。图1 与图3 展示的是单位模板（unit template），即在将电压波形通过 ETI（Randles 电路）转换为电流后得到的单位 CV 波形，以及用于比较的单位 CC 双相模板（均在归一化、尚未乘以缩放因子 A 的状态）。在阈值搜索中，每个单位模板 w(t) 会被乘以一个缩放因子 A 并注入中央节点，阈值缩放因子 A_th 是能引发传播性动作电位的最小 A；最终报告的峰值阈值电流以 pA 为单位，按如下关系计算：I_th = A_th * I_peak，其中 I_peak 是单位模板的峰值（单位 A），代码中将其乘以 1e12 转换为 pA。代码同时计算了电荷阈值 Q_th 作参考，但由于 CC 为净零电荷双相脉冲且我们主要比较峰值阈值，I_th 是主要比较指标。请在论文 Methods 或 figure caption 中明确此缩放与转换关系，以免读者将图中实线/虚线误认为已是最终 Ith。


图 1（阳极先，单位模板）简要说明

图 1 显示了在阳极先刺激条件下，ETI 滤波后的 CV 单位电流波形与理想 CC 双相单位波形的差异。两者均为单位模板（尚未缩放）。可以看到，CC 波形在相位内保持方波，而 CV 波形因 ETI 影响呈现“峰值 + 衰减”结构。该图的目的仅在于说明 CV 在时间上具有明显衰减，而 CC 维持恒定电流，为后续阈值差异提供直观基础。

（→ 图 1 只是说明波形形状差异，不讨论阈值。）

图 2（阳极先，Ith vs 直径）重点说明

图 2 是 Aim 1 的关键结果之一，比较了在阳极先刺激下，CC 与 CV 的膜内峰值阈值电流 I_th（pA）随纤维直径的变化趋势。可以看到，随着直径增加，CC 和 CV 的阈值都上升——这是因为大直径纤维具有更低输入阻抗，需要更大电流才能达到相同的去极化。然而，两条曲线始终保持明显分离：CV 的阈值在所有直径上均高于 CC。更重要的是，CV–CC 的阈值差随直径增加而增大。这表明 ETI 对 CV 的滤波效应（衰减波形减少了相位内的有效驱动力）对大直径纤维影响更强。

换言之，图 2 显示 CV 在膜层面上比 CC 更难激发，且这种不利程度随直径增加而加剧。

图 3（阴极先，单位模板）简要说明

图 3 与图 1 相同，只是将相位顺序由阳极先改为阴极先。可以看到，CC 波形仍保持方波形态，而 CV 波形依旧呈“峰值 + 衰减”的衰减结构。该图仅说明：
极性改变并不改变 ETI 对 CV 波形施加的快速衰减效应。
单位模板的差异在两种极性下具有一致性。

（→ 图 3 同样只是说明波形时程的极性对称性，不讨论阈值。）

图 4（阴极先，Ith vs 直径）重点说明，并与图 2 对比

图 4 展示阴极先刺激下的膜内阈值 I_th。其结果与图 2（阳极先）高度一致：

CV 的阈值始终高于 CC

阈值差随纤维直径增加而扩大

两类波形均呈 Ith 随直径单调上升

将图 2 与图 4 对比可得出关键结论：
ETI 对 CV 的削弱作用与刺激相位顺序无关（polarity-independent）。

也就是说，无论是阳极先还是阴极先，CV 因波形衰减导致的有效驱动力降低都会使 I_th 明显高于 CC，且大直径纤维受影响最显著。


###  aim2
图 1（Aim 2）：Ipeak threshold vs diameter（anodic-first）——外场阈值随直径变化

该图展示了在阳极先刺激条件下，不同直径纤维在外场点源刺激下的电极峰值电流阈值（µA）。与 Aim 1 的膜内注入阈值不同，Aim 2 的 I_peak_th 代表的是：外部电极必须输出的峰值电流大小，才能通过体积导体耦合产生足以激活节点的外电位。

可以看到：

CC 的阈值始终显著低于 CV
所有直径中，CV filtered 曲线均高于 CC 曲线，这与 Aim 1 的结果一致，说明 经过 ETI 滤波的 CV 波形在外场条件下依然显著不如 CC 有效。

阈值随直径略有下降（外场特有现象）
与 Aim 1 不同，外场模型下阈值不再随直径上升，而是缓慢下降，这是典型的 extracellular activation 特征：
大直径纤维由于空间常数大、轴向电流耦合强，更容易被外场激发（large-first recruitment）。

CV–CC 的差距随着直径增加略有减小，但仍保持明显分离
虽然曲线之间的垂直差距略变小，但 CV 始终高于 CC，说明 CV 在几何耦合下依旧较难激发，但外场效应（activating function）部分抵消了膜层面差异，使差距不像 Aim 1 那么剧烈。

总结：
在外场耦合下，CV 的阈值仍高于 CC，但空间几何效应使两者差距被部分缓冲。

图 2（Aim 2）：Recruitment curves（anodic-first）——招募曲线比较

该图展示阳极先条件下的招募曲线，横轴为电极峰值电流 (µA)，纵轴为被招募纤维的比例。

关键观察：

CC 的招募非常陡峭（高选择性）
招募几乎在 3.8–4.2 µA 的狭窄区间内完成，表明 CC 刺激能够快速、集中地激活大直径纤维，随后迅速覆盖整个纤维群。

CV 的招募区间大幅右移且更分散（选择性下降）
CV 需要接近 8–10 µA 才能达到与 CC 相同的招募水平，且招募曲线上升更平缓，说明：

更高电流才能开始招募

招募范围变宽，选择性下降

CV 的 ETI 衰减效应在外场情境下明显降低效率

整体效果：CV 招募延迟、效率降低、选择性变差

图 2 总结了 Aim 2 的核心结论：
在外场刺激中，ETI 滤波显著推迟了 CV 的招募起点，使其所需刺激强度远高于 CC。

（二）阴极先刺激（cathodic-first）
图 3（Aim 2）：Ipeak threshold vs diameter（cathodic-first）——外场阈值随直径变化

图 3 是图 1 的阴极先版本，结论高度一致：

CV 的阈值在所有直径下仍高于 CC
表明 ETI 滤波削弱 CV 的有效驱动在两个极性下均成立，属于极性无关效应（polarity-independent effect）。

阈值随直径下降，仍体现典型 large-first 特性
阴极先并未改变这种趋势，符合外场激发的空间耦合机制。

CV–CC 的差距在阴极先下略更明显
CV 阈值比 CC 更高且下降更慢，说明在阴极先条件下，CV 的衰减在激发效率上的不利影响更加突出。

图 4（Aim 2）：Recruitment curves（cathodic-first）——招募曲线比较

招募曲线和阳极先的情况高度一致，但相对更“右移”：

CC 在约 7–7.5 µA 时几乎完全招募完毕
阴极先刺激的 CC 需求略高于阳极先，但仍保持高选择性。

CV 的招募明显延后（大约 8.5–10.5 µA）
ETI 衰减在阴极先条件下更影响 CV 的负相位/正相位耦合，使 CV 的外场激活效率更差。

CV 的招募曲线分布更平滑（选择性进一步下降）

从图 2 与图 4 结合可得出 Aim 2 的稳健结论：
ETI 对 CV 激发效率的削弱在阳极先与阴极先条件下均存在，且阴极先略更明显，但趋势一致：CC 招募快且集中，CV 招募慢且分散。












# aim1

## 第一个问题：CV和CC比较的话看Ith 并不看 Qth
1. 生理学传统：电流是兴奋的基础

电生理学的经典模型将电流视为产生兴奋的直接驱动力。

强度–时程曲线（Strength–Duration Curve）：
由 Lapicque (1907) 定义，其基础变量就是电流。

Lapicque 公式：
	​Ith​(τ)=Ir​(1+τc​/τ ​)

Ir（基电流）是电流阈值的绝对下限。

实验的便利性：
在神经刺激实验中，恒电流（CC）刺激是最常见的模式。实验者可以精确控制和测量电极输出的电流强度。

直接可比性：
实测的 Ith可直接用于比较不同神经纤维、不同波形或不同生理条件下的兴奋性


### 模型：代码用的是MRG-like simplified model
在 节点 (node) 上插入了 MRG 的 axnode.mod 机制
但是：

节间 (internode) 只用了一个被动机制 pas，而没有包括 MRG 的 myelin 电导、电容、轴向空间参数；

没有 MRG 原文里的 periaxonal space、flut、MYSA 等过渡段；

所有几何（节长、节间长、直径、通道密度缩放）都是脚本里人工设置的简化形式，而非论文表格中的多段结构。

点电流注入 + internode 长度随直径线性增加 + gnabar 缩放 α=0.8

IClamp 点注入电流：电流在节点内注入（不是电极外场）。

节点面积随直径增加：注入电流分布到更大的膜面积。

internode 长度随直径增加（internode_len = max(50, 100*d)）：节点间距变大。

gnabar 以 α=0.8 缩放：钠通道密度增加幅度低于面积增加幅度（因为面积 ~d²，但 gnabar ~d^0.8）

### 模型用的是单节点内注入电流（intracellular current injection）
经典文献中的“大直径更易激活”通常指外部电场刺激（extracellular field stimulation）
我的结果并不违背


### Ith = Ath * Icath_peak 

Ath​,阈值缩放因子,Threshold Scale Factor,通过二分法搜索得到的最小乘数因子，当施加到归一化单位波形上时，能够刚好触发轴突模型的动作电位 (AP) 兴奋。Ath​ 越小，表明刺激波形的效率越高。
Icath_peak​,单位波形阴极峰值,Cathodic Peak Current of Unit Waveform,归一化电流单位波形 (InA_unit​) 中，具有最大绝对值的阴极相（负电流，即激发相）峰值电流。该值通常以安培 (A) 为单位计算，用于确定实际的阈值电流强度。
Ith​,阈值峰值电流,Threshold Peak Current,触发动作电位 (AP) 所需的实际最小阴极峰值电流。计算公式为：Ith​=Ath​×Icath_peak​ Ith​ 越小，表明激活 AP 越容易。




### 创新点
🔹 代表性文献

McIntyre, Richardson, & Grill, 2002, IEEE Trans. Biomed. Eng.

建立了 MRG 模型，系统研究了外部电场刺激下不同直径的阈值。结论：在外场刺激下，大直径纤维阈值更低（更容易激活）。
但他们主要用的是 extracellular stimulation，而不是点电流注入。

Rattay, 1989, 1999, 2000 系列论文

用电缆模型分析外电场的膜电位分布与激发条件。
同样是外场耦合型刺激，没有电流注入。

Howells et al., 2012 (J. Neural Eng.)

扩展了 MRG 模型，分析了直径、节点电性变化、钠通道分布对阈值的影响。
依然是外场刺激。

➡️ 你的不同点：
你采用了IClamp 点注入方式（内注入），并且让 internode 长度、gnabar 等随直径变化，这在 MRG 类研究中极少出现。
多数论文只做过外场条件下的 scaling，几乎没人系统量化“电流注入条件下阈值 vs 直径”的关系



### 结果分析
CC（方波）仍然比 CV（ETI）更有效很多，尤其在大直径处 CV 的 Ith 飙升至几百 µA，而 CC 仅几十 µA。
ETI（CV，电压经 Randles 滤波变成电流）显著降低了刺激的“瞬时阴极有效性”，表现为 在小直径时差别小，但随直径增大 ETI 会显著提高阈值电流 Ith
#### CC和CV倍数对比
直径 1–6 µm：Ith_CV / Ith_CC ≈ 0.9 – 1.2（≈ 无差别）

直径 8 µm：≈ 2.4×（CV ≈ 60 µA vs CC ≈ 25 µA）

直径 10 µm：≈ 4.5×（CV ≈ 160 µA vs CC ≈ 35 µA）

直径 12 µm：≈ 4.                                         0 – 5.0×（CV ≈ 350–480 µA vs CC ≈ 75–95 µA）

#### 双相情况阴极和阳极先结果对比
阴极相（负电流） → 膜外变负、膜内变正 → 膜去极化，有利于动作电位产生。

阳极相（正电流） → 膜外变正、膜内变负 → 膜超极化，抑制兴奋性。
因此：

先阴极 → 一上来就去极化 → 容易激活；
先阳极 → 一开始超极化 → 钠通道部分失活、膜更稳定 → 需要更大阴极电流才能“反超”这个抑制。



## 分析Qth 
为什么CC更大

CC 的 Qₜₕ 绝对值更大，是因为恒流方波在阈值时持续时间更长、波形更“宽”，带来的总电荷积更大；
而 CV 波形经 ETI 滤波后阴极峰虽短、幅度高，但尾部迅速衰减，总电荷积小。

Qth（Threshold charge）
→ 是波形的积分面积：Qth = A_th × ∫ I_unit dt。
→ 同样与 A_th 成正比

# aim2
## 结果

### Ith Ratio (CV/CC) vs diameter

Ith Ratio=Ith, CC / Ith, CV
当比值 ≈ 1 时，表示 CV (恒压) 和 CC (恒流) 的阈电流几乎相同；

比值 > 1 说明 CV 需要更大的峰值电流才能激发同样的神经纤维。

结果：

小直径（≤ 6 µm）纤维： ratio ≈ 1 → ETI 滤波影响小，CV 与 CC 几乎等效。

大直径（≥ 8 µm）纤维： ratio 迅速上升到 4–5 → 恒压模式显著降低了大纤维的兴奋性。

解释：

ETI 电容使电流前沿变慢（低通滤波）；

大直径纤维膜时间常数短、对慢上升信号钝化更强（accommodation）；

结果：在 CV 刺激下，大纤维被“过滤掉”，小纤维相对更容易激发。


### Recruitment curves (CC vs CV) 与 Recruitment difference

CC（标准双相方波，阴极先）在低到中等电流下比 CV（ETI 滤波后由电压→电流得到的波形）更早招募纤维。也就是说，在同一刺激峰值下，CC 激活的纤维比例更高。

差异在中低电流区最大（差值曲线在大约几十到上百 µA 的范围达到峰值），高电流时两者都几乎完全招募（差回到 0）。

按面积加权（d²）会放大差异：area-weighted 的 CC − CV 峰值明显高于 unweighted。说明 CC 在那些电流区主要多招募的是较粗的纤维，而 CV 在相同电流下尚未招募这些粗纤维。

你的 Ith 曲线也显示：CV 的 Ith 随直径增大上升更快（大直径更难被 CV 激活），因此 CV 相较 CC 对大直径的不利更明显（这正好解释第 3 点）。

